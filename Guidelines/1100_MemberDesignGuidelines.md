<!--
NOTE: Requires Markdown Extra. See http://michelf.ca/projects/php-markdown/extra/
 --> 

#メンバーのデザインガイドライン

### プロパティはあらゆる順番でセットできるようにする (AV1100) ![](images/1.png)

プロパティは、他のプロパティに対してステートレスでなくてはならない。すなわち、DataSource プロパティの後でDataMemberをセットした場合とその逆で差があってはいけない。

### プロパティの代わりにメソッドを使用する (AV1105) ![](images/3.png)

- フィールドの値をセットするよりも負荷が大きいもの
- Object.ToString メソッドのように変換を意味するもの
- 引数が同じでも、呼び出されるたびに異なる結果を返す場合。例えば、NewGuidメソッドは、呼び出されるたびに違う値を返すもの
- 直接関係ないプロパティの内部状態によって異なる([コマンドとクエリ分離](http://martinfowler.com/bliki/CommandQuerySeparation.html)に違反)など、操作の副作用が発生するもの

**例外** 内部キャッシュへの投入や遅延読み込みはよい例である。

### 相互排他なプロパティを使用しない (AV1110) ![](images/1.png)

同時に使用できないプロパティを持つことは、通常ひとつの型に2つの相反するコンセプトを持つことを意味している。これらのコンセプトはいくつかの振る舞いや状態を共有しているにも関わらず、協力できない異なるルールを持っている。

この違反はドメインモデルでよく見られ、これらの競合するルールに関連する条件付きロジックのすべての種類でメンテナンス負荷を大幅に悪化させる波及効果を引き起こす。

### メソッドやプロパティはひとつのことだけをする (AV1115) ![](images/1.png)

ルールAV1000と同様、メソッドは単一の責任だけを持つべきである。

### ステートフルなオブジェクトを静的メンバーとして公開してはいけない (AV1125) ![](images/2.png)

ステートフルなオブジェクトとは、多くのプロパティとその背後にある多くの振る舞いが含まれているオブジェクトである。オブジェクトを静的プロパティや静的メソッドを通じて、他のオブジェクトに公開した場合、リファクタリングやユニットテストが難しく、ステートフルオブジェクトに依存したクラスになってしまう。そのような作りになっている場合、一般的にこの章にある多くのガイドラインに違反したよい例である。

ASP.NETの一部である`HttpContext.Current`プロパティはこの例のひとつである。ひどいコードとして`HttpContext`のソースコードを参照して欲しい。事実、テストガイドライン[やっかいなものを切り離す](http://msdn.microsoft.com/en-us/magazine/dd263069.aspx#id0070015)では、このクラスをよく参照している。

### コレクションクラスの代わりに`IEnumerable<T>`や`ICollection<T>`を返す (AV1130) ![](images/2.png)

一般的に呼び出し元で内部コレクションを変更できないようにしたいので、配列、リストなどのコレクションクラスを直接返してはいけない。代わりに`IEnumerable<T>`や、呼び出し元でカウントが必要なら`ICollection<T>`を返す。

**Note** .NET 4.5を使っているのであれば、 `IReadOnlyCollection<T>`、`IReadOnlyList<T>`、`IReadOnlyDictionary<TKey, TValue>`も使用することができる。

### 文字列やコレクションのプロパティ、メソッド、引数は`null`であってはならない (AV1135) ![](images/1.png)


nullを返すことは呼び出し元が予期できない。`null`ではなく、空のコレクションや空文字列を返すようにする。これはまた、`null`チェックを追加するかさらに悪い`string.IsNotNullOrEmpty()`であなたのコードベースが乱雑になることを防止する。

### できるだけ具体的なパラメータを定義する (AV1137) ![](images/2.png)

メンバーが特定のデータを必要とする場合、コンテナオブジェクトを受け取るのではなく、明示的なパラメータを定義する。例えば、`IConfiguration` （構成）インターフェイスで公開されている接続文字列が必要なメソッドがあった場合、構成全体への依存性を持つのではなく、単に接続文字列をパラメータとして定義する。これは必要のない結合を防ぐだけでなく、長期的な保守性を向上させる。

### プリミティブよりもドメイン固有の値型を検討する (AV1140) ![](images/3.png)

string, int, decimalなどを使うのではなく、ISBN番号、Eメールアドレスや金額などドメイン固有の型など、データとそれに適用されるバリデーションルールの両方をラップした専用の値オブジェクトの作成を検討する。これを行うことにより、同じビジネスルールが複数存在することがなくなり、保守性とバグの防止の両方が改善される。
